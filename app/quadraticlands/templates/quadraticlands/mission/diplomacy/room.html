{% extends 'quadraticlands/components/base.html' %}
{% load humanize static i18n %}

{% block 'twittercard' %}
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@gitcoin" />
<meta name="twitter:title" content="{{game.title}} - Quadratic Diplomacy" />
<meta name="twitter:description"
  content="Join {{game.players_text}} playing Quadratic Diplomacy.  Bring your GTC" />
<meta name="twitter:image" content="{% static "v2/images/quadraticlands/twitter/diplomacy.png" %}" />
{% endblock %}

{% block 'content' %}


{% csrf_token %}

<!-- Diplomacy Room Hero -->
<section class="hero knightrider" data-kinetics-mode data-kinetics-mode-type="rain" data-kinetics-mode-speed="5"
  data-kinetics-mode-boundery="endless">

  <div class="background">
    <!-- svg needs preserveAspectRatio="xMidYMid slice" -->
    {% include "quadraticlands/_inlinesvg/hero-diplomacy.svg" %}
  </div>

  <div class="content centered pushdown" data-kinetics-attraction data-kinetics-attraction-chance=".6"
    data-kinetics-attraction-force="3" data-kinetics-attraction-grow="5">
    <a href="/quadraticlands/mission/diplomacy"><h1><span>Quadratic Diplomacy</span></h1></a>
    <h1 class="big">{{game.title}}</h1>
  </div>

</section>

<!-- intro-->
<section class="introduction" style="margin-bottom: 3em;">
	<p>This room was created {{game.created_on | naturaltime}} by @{{game.admin.profile.handle}} and is admin'd by @{{game.admin.profile.handle}}; it has {{game.active_players.count}} people in it & represents {{game.gtc_used}} of GTC and has created {{game.sybil_created}} of Sybil Resistence on Gitcoin.</p>
</section>




<!-- members to vouche -->
<section class="diplomacy-room-members" data-kinetics-mode data-kinetics-mode-type="space" data-kinetics-mode-speed="1">

	{% for player in game.active_players.all %}
	<div class="member-card">
		<div class="front">
			<figure><img src="/dynamic/avatar/scco"></figure>
			<div class="username">@{{player.profile.handle}}</div>
			<div class="tokens_in">{{player.tokens_in}}</div>
			<div class="tokens_out">{{player.tokens_out}}</div>
			<input data-kinetics-attraction data-member {% if player.profile.handle == github_handle %}readonly{% endif %} data-member data-userid="{{player.profile.id}}" data-username="{{player.profile.handle}}" type="number" placeholder="0" value="">
		</div>
		<div class="back">
			<div class="wrapper tokens_in">
				<h3>kevin</h3>
				<div>catwoman<span>143</span></div>
				<div>peter<span>11</span></div>
				<div>sabrina<span>13.21</span></div>
			</div>
			<div class="wrapper tokens_out">
				<div>kevin<span>143</span></div>
				<div>peter<span>11</span></div>
				<div>sabrina<span>13.21</span></div>
			</div>
		</div>
	</div>
	{% endfor %}



</section>




<!-- diplomacy vouche bar -->
<section class="diplomacy-vouche-bar">

	<!-- @kev : this is the place where we do some calculations in jscript
	and populate the divs via the #ids -->

	<div class="col">
		<p>Wallet <span id="diplomacy_wallet_address"></span></p>
		<div id="diplomacy_wallet_balance"></div>
	</div>

	<div class="col">
		<p>Used</p>
		<!-- @kev: put the amount from db here. in the data-atrib and the div itself! -->
		<div id="diplomacy_wallet_used" data-used="0">0</div>
	</div>

	<div class="col">
		<p>Available</p>
		<!-- @kev: will be calculated by current wallet - in database used -->
		<div id="diplomacy_wallet_available"></div>
	</div>

	<div class="col">
		<p>Use</p>
		<div id="diplomacy_wallet_use">0</div>
	</div>

	<div class="col">
		<a id="vouche_button" class="btn aqua" data-kinetics-attraction data-kinetics-attraction-grow="6">Vouch</a>
	</div>

</section>



<!-- diplomacy roomlog headline -->
<section class="introduction" style="margin-top: 6em; margin-bottom: 3em;">
  <h1>Roomlog</h1>
</section>
<!-- diplomacy roomlog -->
<section class="diplomacy-roomlog" style="margin-top:3em;">

	{% for feed in game.feed.all %}

	<div class="entry">

		<span class="member">
			<img src="/dynamic/avatar/{{feed.player.profile.handle}}">
			<span class="username">{{feed.player.profile.handle}}</span>
		</span>

		<span class="action">

			{{feed.data.action}}

			{{feed.data.chat}}

		</span>
		<!--
		<span class="member">
			<img src="/dynamic/avatar/scco">
			<span class="username">peter schiff</span>
			<span class="tokens">3123.32</span>
		</span>	

		<span class="member">
			<img src="/dynamic/avatar/scco">
			<span class="username">kevin</span>
			<span class="tokens">312323.32</span>
		</span>

		<span class="member">
			<img src="/dynamic/avatar/scco">
			<span class="username">superlongusername</span>
			<span class="tokens">312323.32</span>
		</span>
		-->
		<span class="time">{{feed.created_on | naturaltime}}</span>

	</div>
	{% endfor %}

<form method="POST" action="{{game.url}}#chat">
<section class="diplomacy-chat-room" id="chat">
	<div class="wrapper">
		<div class="info">
			Type a message
		</div>
		<div id="chat_room_interface" class="input">
			{% csrf_token %}
				<input id="chat_room" name="chat" type="text" placeholder="never gonna give you up">
				<button  id="send_chat_button">Send</button>
		</div>
	</div>
</section>
</form>



</section>



{% if is_admin %}

<!-- administration headline -->
<section class="introduction" style="margin-bottom: 3em;">
  <h1>Administration</h1>
</section>


<!-- diplomacy invite -->
<section class="diplomacy-invite">
  <div class="wrapper">
    <div class="info">
      [{{game.active_players | length}} Player{{game.active_players | pluralize}} Active /{{max_players}} Slots] Invite up to {{max_players}} total players with this Link
    </div>
    <div class="input">
      <input id="room_link" type="text" readonly value="https://gitcoin.co/quadraticlands/mission/diplomacy/4934-devilhunters">
      <button id="room_link_button">copy</button>
    </div>
  </div>
</section>
{% endif %}



{% if is_admin %}
<section class="diplomacy-member-admin">

	{% for player in game.active_players %}
	<div class="member {% if player.admin %} self {% endif %}">
		<img src="/dynamic/avatar/{{player.profile.handle}}">
		<span class="username">@{{player.profile.handle}}</span>
		<div class="action"><a class="btn pink" href="{{game.url}}?remove={{player.profile.handle}}">Remove</a></div>
	</div>
	{% endfor %}


</section>
{% endif %}



<!-- danger zone -->
<section class="introduction" style="margin-top: 6em; margin-bottom: 3em;">
  <h1>Danger Zone</h1>
</section>

{% if is_admin %}

<!-- danger zone admin : delete room -->
<section class="diplomacy-delete-room">
	<div class="wrapper">
		<div class="info">
			Enter your Roomname <span>{{game.title}}</span> to delete it
		</div>
		<div id="delete_room_interface" class="input">
			<input id="delete_room" type="text" placeholder="Roomname" data-roomname="{{game.title}}">
			<button class="disabled" onclick="javascript:document.location='{{game.url}}?delete=t'" id="delete_room_button">Delete Room</button>
		</div>
	</div>
</section>

{% else %}

<!-- danger zone for members - but NOT the admin-->
<section class="diplomacy-leave-room">
	<div class="wrapper">
		<div class="info">
			Type <span>live long and prosper</span> to leave the Room
		</div>
		<div id="leave_room_interface" class="input">
			<input id="leave_room" type="text" placeholder="leave Room" data-phrase="live long and prosper">
			<button class="disabled" onclick="javascript:document.location='{{game.url}}?delete=t'" id="leave_room_button">Leave Room</button>
		</div>
	</div>
</section>

{% endif %}







{% endblock %}

{% block 'scripts' %}

<!-- force web3modal to popup automatically when no provider selected-->
<script src="{% static "v2/js/quadraticlands/forceWallet.js" %}"></script>

<!-- sfx library-->
<script src="{% static "v2/js/lib/quadraticlands/tone.js" %}"></script>

<!-- animate workstream page header image ( hero-workstream.svg ) -->
<script src="{% static "v2/js/quadraticlands/mission/diplomacy/room.js" %}"></script>

{% endblock %}
